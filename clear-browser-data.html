<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸Œë¼ìš°ì € ë°ì´í„° ì™„ì „ ì‚­ì œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #b71c1c;
        }
        .success {
            background: #4caf50;
        }
        .success:hover {
            background: #388e3c;
        }
        #log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—‘ï¸ ë¸Œë¼ìš°ì € ë°ì´í„° ì™„ì „ ì‚­ì œ</h1>
        <p>ì´ í˜ì´ì§€ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ëœ ëª¨ë“  ë¡œì»¬ ë°ì´í„°ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.</p>
        
        <button onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
        <button onclick="checkData()">í˜„ì¬ ë°ì´í„° í™•ì¸</button>
        <button class="success" onclick="goToApp()">ì•±ìœ¼ë¡œ ì´ë™</button>
        
        <div id="log"></div>
    </div>

    <script>
        const log = document.getElementById('log');
        
        function addLog(message) {
            log.textContent += message + '\n';
            console.log(message);
        }

        async function clearAllData() {
            log.textContent = '';
            addLog('=== ë°ì´í„° ì‚­ì œ ì‹œì‘ ===\n');
            
            // 1. IndexedDB ì‚­ì œ
            try {
                addLog('1. IndexedDB ì‚­ì œ ì¤‘...');
                const dbNames = ['historyDB', 'grimoireDB', 'history', 'grimoire', 'keyval-store'];
                
                for (const dbName of dbNames) {
                    try {
                        await new Promise((resolve, reject) => {
                            const request = indexedDB.deleteDatabase(dbName);
                            request.onsuccess = () => {
                                addLog(`   âœ… ${dbName} ì‚­ì œ ì™„ë£Œ`);
                                resolve();
                            };
                            request.onerror = () => {
                                addLog(`   âš ï¸ ${dbName} ì‚­ì œ ì‹¤íŒ¨ (ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ)`);
                                resolve();
                            };
                            request.onblocked = () => {
                                addLog(`   âš ï¸ ${dbName} ì‚­ì œ ì°¨ë‹¨ë¨`);
                                resolve();
                            };
                        });
                    } catch (err) {
                        addLog(`   âŒ ${dbName} ì˜¤ë¥˜: ${err.message}`);
                    }
                }
            } catch (err) {
                addLog(`âŒ IndexedDB ì‚­ì œ ì˜¤ë¥˜: ${err.message}`);
            }
            
            // 2. localStorage ì‚­ì œ
            try {
                addLog('\n2. localStorage ì‚­ì œ ì¤‘...');
                const beforeCount = localStorage.length;
                localStorage.clear();
                addLog(`   âœ… ${beforeCount}ê°œ í•­ëª© ì‚­ì œ ì™„ë£Œ`);
            } catch (err) {
                addLog(`âŒ localStorage ì‚­ì œ ì˜¤ë¥˜: ${err.message}`);
            }
            
            // 3. sessionStorage ì‚­ì œ
            try {
                addLog('\n3. sessionStorage ì‚­ì œ ì¤‘...');
                const beforeCount = sessionStorage.length;
                sessionStorage.clear();
                addLog(`   âœ… ${beforeCount}ê°œ í•­ëª© ì‚­ì œ ì™„ë£Œ`);
            } catch (err) {
                addLog(`âŒ sessionStorage ì‚­ì œ ì˜¤ë¥˜: ${err.message}`);
            }
            
            // 4. ì¿ í‚¤ ì‚­ì œ
            try {
                addLog('\n4. ì¿ í‚¤ ì‚­ì œ ì¤‘...');
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const eqPos = cookie.indexOf('=');
                    const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
                }
                addLog(`   âœ… ${cookies.length}ê°œ ì¿ í‚¤ ì‚­ì œ ì™„ë£Œ`);
            } catch (err) {
                addLog(`âŒ ì¿ í‚¤ ì‚­ì œ ì˜¤ë¥˜: ${err.message}`);
            }
            
            // 5. Cache Storage ì‚­ì œ
            try {
                addLog('\n5. Cache Storage ì‚­ì œ ì¤‘...');
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (const cacheName of cacheNames) {
                        await caches.delete(cacheName);
                        addLog(`   âœ… ${cacheName} ìºì‹œ ì‚­ì œ ì™„ë£Œ`);
                    }
                } else {
                    addLog('   âš ï¸ Cache Storage ë¯¸ì§€ì›');
                }
            } catch (err) {
                addLog(`âŒ Cache Storage ì‚­ì œ ì˜¤ë¥˜: ${err.message}`);
            }
            
            addLog('\n=== âœ… ëª¨ë“  ë°ì´í„° ì‚­ì œ ì™„ë£Œ ===');
            addLog('\nì´ì œ ì•±ìœ¼ë¡œ ì´ë™í•˜ì—¬ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
        }

        async function checkData() {
            log.textContent = '';
            addLog('=== í˜„ì¬ ë°ì´í„° í™•ì¸ ===\n');
            
            // IndexedDB í™•ì¸
            try {
                addLog('1. IndexedDB:');
                if (indexedDB.databases) {
                    const databases = await indexedDB.databases();
                    if (databases.length === 0) {
                        addLog('   âœ… ì—†ìŒ');
                    } else {
                        databases.forEach(db => {
                            addLog(`   - ${db.name} (ë²„ì „: ${db.version})`);
                        });
                    }
                } else {
                    addLog('   âš ï¸ databases() ë¯¸ì§€ì› - ìˆ˜ë™ í™•ì¸ í•„ìš”');
                }
            } catch (err) {
                addLog(`   âŒ ì˜¤ë¥˜: ${err.message}`);
            }
            
            // localStorage í™•ì¸
            addLog('\n2. localStorage:');
            if (localStorage.length === 0) {
                addLog('   âœ… ì—†ìŒ');
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    addLog(`   - ${key}`);
                }
            }
            
            // sessionStorage í™•ì¸
            addLog('\n3. sessionStorage:');
            if (sessionStorage.length === 0) {
                addLog('   âœ… ì—†ìŒ');
            } else {
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    addLog(`   - ${key}`);
                }
            }
            
            // ì¿ í‚¤ í™•ì¸
            addLog('\n4. ì¿ í‚¤:');
            if (!document.cookie) {
                addLog('   âœ… ì—†ìŒ');
            } else {
                const cookies = document.cookie.split(';');
                cookies.forEach(cookie => {
                    addLog(`   - ${cookie.trim()}`);
                });
            }
            
            addLog('\n=== í™•ì¸ ì™„ë£Œ ===');
        }

        function goToApp() {
            window.location.href = '/';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.onload = () => {
            checkData();
        };
    </script>
</body>
</html>
