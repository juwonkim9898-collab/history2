# 한국어 히스토리 기록 시스템 설계

## 개요

현재 영어로만 작동하는 히스토리 기록 앱을 한국어로 완전히 현지화하는 시스템을 설계합니다. 이 설계는 기존 아키텍처를 유지하면서 다국어 지원을 추가하고, 한국어 사용자 경험을 최적화하는 것을 목표로 합니다.

## 아키텍처

### 현재 아키텍처
```
사용자 입력 → App.tsx → geminiService.ts → Gemini API → 영어 응답 → 로컬 저장소 → Grimoire 컴포넌트
```

### 개선된 아키텍처
```
사용자 입력 (한국어) → App.tsx → 현지화된 geminiService.ts → Gemini API (한국어 프롬프트) → 한국어 응답 → 로컬 저장소 → 현지화된 Grimoire 컴포넌트
```

### 주요 변경사항
- **프롬프트 현지화**: Gemini API 호출 시 한국어로 응답하도록 프롬프트 수정
- **UI 텍스트 현지화**: 모든 하드코딩된 영어 텍스트를 한국어로 변경
- **추천 검색어 현지화**: 한국 역사 관련 주제로 변경
- **오류 메시지 현지화**: 모든 오류 및 상태 메시지를 한국어로 변경

## 컴포넌트 및 인터페이스

### 1. App.tsx 수정사항
- **검색 플레이스홀더**: "새로운 역사를 기록해보세요..." 
- **추천 검색어**: ['조선왕조', '고구려', '한국전쟁', '독립운동']
- **버튼 텍스트**: "초기화" (Reset 대신)
- **로딩 메시지**: "기록 중..." (Scribing 대신)
- **오류 메시지**: "기록을 불러올 수 없습니다..." (Could not retrieve 대신)

### 2. Grimoire.tsx 수정사항
- **표지 제목**: "역사서" (HISTORIA 유지 가능, 부제목 한국어화)
- **목차 제목**: "목차" (Index 대신)
- **로딩 텍스트**: "기록 중..." (Scribing 대신)
- **페이지 참조**: "페이지" (Pg. 대신)
- **마지막 페이지**: "끝" (Finis 대신)

### 3. geminiService.ts 수정사항
- **프롬프트 현지화**: 한국어로 응답하도록 지시
- **오류 메시지**: 한국어 오류 메시지 제공
- **응답 검증**: 한국어 텍스트 처리 개선

## 데이터 모델

### HistoryEvent 인터페이스 (변경 없음)
```typescript
export interface HistoryEvent {
  title: string;      // 한국어 제목
  year: string;       // 연도 (서기 형식 유지)
  description: string; // 한국어 설명
  details: string;    // 한국어 상세내용
}
```

### 새로운 상수 정의
```typescript
export const KOREAN_UI_TEXTS = {
  searchPlaceholder: "새로운 역사를 기록해보세요...",
  loading: "기록 중...",
  reset: "초기화",
  index: "목차",
  page: "페이지",
  end: "끝",
  errorTitle: "기록을 불러올 수 없습니다",
  errorMessage: "역사를 불러오는 중 오류가 발생했습니다.",
  confirmReset: "정말로 모든 기록을 삭제하시겠습니까?",
  suggestedTopics: ['조선왕조', '고구려', '한국전쟁', '독립운동']
};
```

## 정확성 속성

*속성은 시스템의 모든 유효한 실행에서 참이어야 하는 특성이나 동작입니다. 본질적으로 시스템이 수행해야 하는 작업에 대한 공식적인 명세입니다. 속성은 사람이 읽을 수 있는 명세와 기계로 검증 가능한 정확성 보장 사이의 다리 역할을 합니다.*

**속성 1: 한국어 검색 응답 생성**
*임의의* 유효한 한국어 검색어에 대해, 검색을 실행하면 반환되는 모든 역사 정보가 한국어로 작성되어야 합니다
**검증: 요구사항 1.1**

**속성 2: 빈 입력 거부**
*임의의* 빈 문자열이나 공백만 포함된 문자열에 대해, 검색 시도 시 입력이 거부되고 시스템 상태가 변경되지 않아야 합니다
**검증: 요구사항 1.2**

**속성 3: 한국어 로딩 메시지 표시**
*임의의* 검색 실행 중에, 로딩 상태일 때 UI에 한국어 로딩 메시지가 표시되어야 합니다
**검증: 요구사항 1.3**

**속성 4: 검색 완료 후 UI 초기화**
*임의의* 검색 완료 후에, 입력 필드가 비워지고 포커스가 설정되어야 합니다
**검증: 요구사항 1.4**

**속성 5: 로컬 저장소 즉시 저장**
*임의의* 새로운 기록 추가 시에, 해당 기록이 로컬 저장소에서 즉시 조회 가능해야 합니다
**검증: 요구사항 1.5**

**속성 6: UI 텍스트 한국어 표시**
*임의의* 앱 초기화 시에, 모든 UI 요소의 텍스트가 한국어로 표시되어야 합니다
**검증: 요구사항 2.1**

**속성 7: 한국어 오류 메시지**
*임의의* 오류 발생 시에, 표시되는 오류 메시지가 한국어로 작성되어야 합니다
**검증: 요구사항 2.2**

**속성 8: 한국어 확인 대화상자**
*임의의* 삭제 동작 시에, 확인 대화상자의 텍스트가 한국어로 표시되어야 합니다
**검증: 요구사항 2.3**

**속성 9: 한국 역사 추천 주제**
*임의의* 추천 검색어 표시 시에, 모든 주제가 한국어이고 한국 역사와 관련되어야 합니다
**검증: 요구사항 2.4**

**속성 10: 책 인터페이스 한국어 라벨**
*임의의* 책 컴포넌트 렌더링 시에, 모든 제목과 라벨이 한국어로 표시되어야 합니다
**검증: 요구사항 2.5**

**속성 11: API 한국어 프롬프트**
*임의의* AI 서비스 호출 시에, 프롬프트에 한국어 응답 지시사항이 포함되어야 합니다
**검증: 요구사항 3.1**

**속성 12: 생성 데이터 한국어 저장**
*임의의* 새로운 기록 생성 시에, 제목, 설명, 상세내용이 모두 한국어로 저장되어야 합니다
**검증: 요구사항 3.2**

**속성 13: 기록 표시 한국어 렌더링**
*임의의* 기록 표시 시에, 모든 텍스트 요소가 한국어로 렌더링되어야 합니다
**검증: 요구사항 3.3**

**속성 14: 연도 형식 일관성**
*임의의* 연도 정보 표시 시에, 서기 연도 형식이 유지되고 한국어 맥락에 적합해야 합니다
**검증: 요구사항 3.4**

**속성 15: 다국어 기록 로딩**
*임의의* 앱 시작 시에, 영어와 한국어 기록이 모두 로드되어야 합니다
**검증: 요구사항 4.1**

**속성 16: 언어 무관 시간순 정렬**
*임의의* 기록 목록 표시 시에, 언어에 관계없이 모든 기록이 시간순으로 정렬되어야 합니다
**검증: 요구사항 4.2**

**속성 17: 다국어 검색 범위**
*임의의* 검색 실행 시에, 영어와 한국어 기록 모두가 검색 대상에 포함되어야 합니다
**검증: 요구사항 4.3**

**속성 18: 저장 형식 호환성**
*임의의* 데이터 저장 시에, 새로운 한국어 기록이 기존 형식과 동일한 구조로 저장되어야 합니다
**검증: 요구사항 4.4**

**속성 19: 한국 역사 추천 주제 표시**
*임의의* 앱 로드 시에, 한국 역사 관련 추천 주제들이 표시되어야 합니다
**검증: 요구사항 5.1**

**속성 20: 추천 주제 자동 검색**
*임의의* 추천 주제 클릭 시에, 해당 주제로 자동 검색이 실행되어야 합니다
**검증: 요구사항 5.2**

**속성 21: 특정 한국사 주제 포함**
*임의의* 추천 주제 목록에, "조선왕조", "고구려", "한국전쟁", "독립운동"이 포함되어야 합니다
**검증: 요구사항 5.3**

**속성 22: 호버 시각적 피드백**
*임의의* 추천 주제 마우스 호버 시에, 시각적 피드백이 제공되어야 합니다
**검증: 요구사항 5.4**

## 오류 처리

### 1. API 호출 오류
- **네트워크 오류**: "네트워크 연결을 확인해주세요"
- **API 키 오류**: "서비스 인증에 실패했습니다"
- **응답 파싱 오류**: "데이터 형식이 올바르지 않습니다"
- **할당량 초과**: "일일 사용량을 초과했습니다"

### 2. 데이터 저장 오류
- **로컬 저장소 용량 초과**: "저장 공간이 부족합니다"
- **데이터 손상**: "저장된 데이터가 손상되었습니다"

### 3. UI 오류
- **컴포넌트 렌더링 오류**: ErrorBoundary로 포착하여 한국어 오류 메시지 표시
- **페이지 플립 오류**: 페이지 전환 실패 시 조용히 처리

## 테스트 전략

### 이중 테스트 접근법

이 프로젝트는 단위 테스트와 속성 기반 테스트를 모두 포함하는 포괄적인 테스트 전략을 사용합니다:

- **단위 테스트**: 특정 예제, 엣지 케이스, 오류 조건을 검증
- **속성 기반 테스트**: 모든 입력에 대해 성립해야 하는 범용 속성을 검증
- 함께 사용하면 포괄적인 커버리지를 제공: 단위 테스트는 구체적인 버그를 포착하고, 속성 테스트는 일반적인 정확성을 검증

### 단위 테스트 요구사항

단위 테스트는 다음을 다룹니다:
- 특정 한국어 검색어에 대한 올바른 동작을 보여주는 구체적인 예제
- 컴포넌트 간 통합 지점
- 단위 테스트는 도움이 되지만 너무 많이 작성하지 않습니다
- 속성 기반 테스트가 많은 입력을 처리하는 역할을 담당합니다

### 속성 기반 테스트 요구사항

- **라이브러리**: React Testing Library와 함께 `fast-check` 사용
- **반복 횟수**: 각 속성 기반 테스트는 최소 100회 반복 실행
- **태깅**: 각 속성 기반 테스트는 설계 문서의 정확성 속성을 명시적으로 참조하는 주석 포함
- **태깅 형식**: `**Feature: korean-history-localization, Property {번호}: {속성 텍스트}**`
- **구현**: 각 정확성 속성은 단일 속성 기반 테스트로 구현
- 이러한 요구사항은 설계 문서의 테스트 전략 부분에서 명시적으로 설명됩니다

### 테스트 파일 구조
```
src/
  __tests__/
    App.test.tsx                 # 앱 레벨 단위 테스트
    App.property.test.tsx        # 앱 레벨 속성 기반 테스트
    components/
      Grimoire.test.tsx          # Grimoire 컴포넌트 단위 테스트
      Grimoire.property.test.tsx # Grimoire 컴포넌트 속성 기반 테스트
    services/
      geminiService.test.tsx     # API 서비스 단위 테스트
      geminiService.property.test.tsx # API 서비스 속성 기반 테스트
```

### 주요 테스트 시나리오
1. **한국어 텍스트 검증**: 모든 UI 요소와 생성된 콘텐츠가 한국어인지 확인
2. **데이터 지속성**: 로컬 저장소 저장/로드 기능 검증
3. **API 통합**: Gemini API 호출과 응답 처리 검증
4. **UI 상호작용**: 검색, 페이지 플립, 삭제 등의 사용자 동작 검증
5. **오류 처리**: 다양한 오류 상황에서의 적절한 한국어 메시지 표시 검증